<div class="section">
  <h2 class="text-xl font-bold mb-6 border-b pb-3 text-[#1976d2]">Project</h2>

  <div class="form-row">
    <div class="flex items-center gap-2">
      <label class="w-40 font-semibold">Form 30</label>
      <button mat-raised-button color="primary" (click)="openForm30Popup($event)">
        <mat-icon>link</mat-icon>
        Link
      </button>
    </div>
    <mat-form-field appearance="fill">
      <mat-label>Business Unit</mat-label>
      <mat-select formControlName="businessUnit" required>
        @for (unit of BuildingUnit | keyvalue; track unit.key) {
        <mat-option [value]="unit.key">
          {{ unit.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Due Date</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="dueDate" />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
    <div>
      {{ formGroup.get('dueDate')?.value | date : 'dd MMM yyyy' | uppercase }}
    </div>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Tender no</mat-label>
      <div style="display: flex; align-items: center; gap: 8px">
        <input matInput formControlName="tenderNo" [disabled]="true" readonly />
        @if (!formGroup.get('tenderNo')?.value || formGroup.get('tenderNo')?.value === 'NEW') {
          <button
            mat-stroked-button
            color="primary"
            (click)="allocateTenderNo()"
            [disabled]="!formGroup.get('dueDate')?.value || allocatingTenderNo"
            type="button"
          >
            Allocate Tender No
          </button>
        }
      </div>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Project Title</mat-label>
      <input matInput formControlName="projectTitle" required />
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Bid Manager</mat-label>
      <input matInput formControlName="BidManager" />
    </mat-form-field>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Estimator</mat-label>
      <input matInput formControlName="Estimator" />
    </mat-form-field>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Planner</mat-label>
      <input matInput formControlName="Planner" />
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Region</mat-label>
      <mat-select formControlName="Region">
        @for (region of regions | keyvalue; track region.key) {
        <mat-option [value]="+region.key">
          {{ region.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Location</mat-label>
      <input matInput formControlName="Location" />
    </mat-form-field>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Planner</mat-label>
      <input matInput formControlName="Planner" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>TenderType</mat-label>
      <mat-select formControlName="TenderType">
        @for (tenderType of tenderTypes | keyvalue; track tenderType.key) {
        <mat-option [value]="+tenderType.key">
          {{ tenderType.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Brief Description</mat-label>
      <textarea matInput formControlName="BriefDescription" rows="3"></textarea>
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-label class="block mb-1">Approximate Value</mat-label>
    <div style="display: flex; gap: 10px">
      <mat-form-field appearance="fill" style="flex: 1">
        <mat-select formControlName="ApproximateValueType" placeholder="Select type">
          @for (currency of currencies | keyvalue; track currency.key) {
          <mat-option [value]="+currency.key">
            {{ currency.value }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill" style="flex: 1">
        <mat-label>e.g. 30M, 5B</mat-label>
        <input matInput formControlName="ApproximateValueInput" placeholder="Enter value" />
      </mat-form-field>
    </div>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Approximate Value Remarks</mat-label>
      <input matInput formControlName="ApproximateValue" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Approximate Margin</mat-label>
      <input matInput formControlName="Approxmargin" />
    </mat-form-field>
  </div>

  <div class="form-row">
    <label class="block mb-1">Maintenance / Defect</label>
    <div style="display: flex; gap: 10px">
      <mat-form-field appearance="fill" style="flex: 1">
        <mat-select formControlName="maintenanceType" placeholder="Select option">
          @for (maintenanceDefect of maintenanceDefects | keyvalue; track maintenanceDefect.key) {
          <mat-option [value]="+maintenanceDefect.key">
            {{ maintenanceDefect.value }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill" style="flex: 1">
        <input
          matInput
          type="number"
          formControlName="maintenanceValue"
          placeholder="Enter number"
        />
      </mat-form-field>
      <mat-form-field appearance="fill" style="flex: 1">
        <mat-select formControlName="maintenanceStatus1" placeholder="Select status">
          <mat-option value="months">months</mat-option>
          <mat-option value="days">days</mat-option>
          <mat-option value="years">years</mat-option>
          <mat-option value="weeks">weeks</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <div class="form-row" style="display: flex; gap: 1rem; flex-wrap: wrap">
    <!-- Client -->
    <mat-form-field appearance="fill" style="flex: 1">
      <mat-label>Client</mat-label>
      <input matInput formControlName="clientName" placeholder="Enter client name" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <input matInput type="number" formControlName="contractPeriodValue" />
    </mat-form-field>
    <!-- Contract Period Unit -->
    <mat-form-field appearance="fill" style="width: 180px">
      <mat-label>Contract Period</mat-label>
      <mat-select formControlName="contractPeriodUnit" placeholder="Select unit">
        <mat-option value="months">Months</mat-option>
        <mat-option value="days">Days</mat-option>
        <mat-option value="years">Years</mat-option>
        <mat-option value="weeks">Weeks</mat-option>
      </mat-select>
    </mat-form-field>
    <!-- Client Contact Person -->
    <mat-form-field appearance="fill" style="flex: 1">
      <input
        matInput
        formControlName="ComplexContractPeriod"
        placeholder="for complex contract Period"
      />
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>Financial Standing</mat-label>
      <mat-select formControlName="FinantialStanding">
        @for (financeStanding of financeStandings | keyvalue; track financeStanding.key) {
        <mat-option [value]="+financeStanding.key">
          {{ financeStanding.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="form-row">
    <div class="form-row">
      <label class="block mb-1">Tender Market Scheme</label>
      <mat-radio-group formControlName="TenderMarketScheme" class="flex gap-6">
        @for (key of yesNo | keyvalue; track key.key) {
        <mat-radio-button [value]="key.key">{{ key.value }}</mat-radio-button>
        }
      </mat-radio-group>
    </div>

    <mat-form-field appearance="fill">
      <mat-label>Financial/Technical Split Value</mat-label>
      <mat-select formControlName="FinancialTechnicalSplitValue">
        @for (split of financeTechnicalSplits | keyvalue; track split.key) {
        <mat-option [value]="+split.key">
          {{ split.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Bid Type</mat-label>
      <mat-select formControlName="BidType" placeholder="Select Bid Type">
        @for(bidtype of bidTypes | keyvalue; track bidtype.key) {
        <mat-option [value]="+bidtype.key">
          {{ bidtype.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <!-- JV Partner(s) field - shown only when bid type is Joint Venture Bid (value 2) -->
  @if (isJointVentureBid) {
  <div class="form-row">
    <mat-form-field appearance="fill">
      <mat-label>JV Partner(s)</mat-label>
      <textarea
        matInput
        formControlName="JvPartner"
        placeholder="Enter Joint Venture Partner details"
      ></textarea>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>JV Split</mat-label>
      <input matInput formControlName="JvSplit" placeholder="Enter Joint Venture Split details" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>JV Agreement in Place</mat-label>
      <mat-select formControlName="JvAgreement" placeholder="Select Option">
        @for (jvAgreement of jvAgreementOptions | keyvalue; track jvAgreement.key) {
        <mat-option [value]="+jvAgreement.key">
          {{ jvAgreement.value }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
  }
</div>
